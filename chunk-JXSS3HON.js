import{a as U,b as C}from"./chunk-VS2QB7XP.js";import{I as v,P as l,U as m,Y as g,Z as f,ac as x,bc as S,ha as I,ma as h,xa as b}from"./chunk-MVS5HVBG.js";var D=(()=>{let t=class t{constructor(e,o){this.document=e,this.platformId=o,this.documentIsAccessible=x(this.platformId)}static getCookieRegExp(e){let o=e.replace(/([[\]{}()|=;+?,.*^$\\])/gi,"\\$1");return new RegExp("(?:^"+o+"|;\\s*"+o+")=(.*?)(?:;|$)","g")}static safeDecodeURIComponent(e){try{return decodeURIComponent(e)}catch{return e}}check(e){return this.documentIsAccessible?(e=encodeURIComponent(e),t.getCookieRegExp(e).test(this.document.cookie)):!1}get(e){if(this.check(e)){e=encodeURIComponent(e);let s=t.getCookieRegExp(e).exec(this.document.cookie);return s?.[1]?t.safeDecodeURIComponent(s[1]):""}else return""}getAll(){if(!this.documentIsAccessible)return{};let e={},o=this.document;return o.cookie&&o.cookie!==""&&o.cookie.split(";").forEach(s=>{let[n,r]=s.split("=");e[t.safeDecodeURIComponent(n.replace(/^ /,""))]=t.safeDecodeURIComponent(r)}),e}set(e,o,s,n,r,u,k,L){if(!this.documentIsAccessible)return;if(typeof s=="number"||s instanceof Date||n||r||u||k){let d={expires:s,path:n,domain:r,secure:u,sameSite:k||"Lax",partitioned:L};this.set(e,o,d);return}let c=encodeURIComponent(e)+"="+encodeURIComponent(o)+";",i=s||{};if(i.expires)if(typeof i.expires=="number"){let d=new Date(new Date().getTime()+i.expires*1e3*60*60*24);c+="expires="+d.toUTCString()+";"}else c+="expires="+i.expires.toUTCString()+";";i.path&&(c+="path="+i.path+";"),i.domain&&(c+="domain="+i.domain+";"),i.secure===!1&&i.sameSite==="None"&&(i.secure=!0,console.warn(`[ngx-cookie-service] Cookie ${e} was forced with secure flag because sameSite=None.More details : https://github.com/stevermeister/ngx-cookie-service/issues/86#issuecomment-597720130`)),i.secure&&(c+="secure;"),i.sameSite||(i.sameSite="Lax"),c+="sameSite="+i.sameSite+";",i.partitioned&&(c+="Partitioned;"),this.document.cookie=c}delete(e,o,s,n,r="Lax"){if(!this.documentIsAccessible)return;let u=new Date("Thu, 01 Jan 1970 00:00:01 GMT");this.set(e,"",{expires:u,path:o,domain:s,secure:n,sameSite:r})}deleteAll(e,o,s,n="Lax"){if(!this.documentIsAccessible)return;let r=this.getAll();for(let u in r)r.hasOwnProperty(u)&&this.delete(u,e,o,s,n)}};t.\u0275fac=function(o){return new(o||t)(g(I),g(b))},t.\u0275prov=m({token:t,factory:t.\u0275fac,providedIn:"root"});let a=t;return a})();var R=class a{httpClient=f(S);userService=f(C);cookieService=f(D);isLoggedIn=h(!1);userData=h(null);login(t){return this.httpClient.post(U.baseApiUrl+"auth/login",t).pipe(l(p=>{this.cookieService.set("token",p.token),this.cookieService.set("username",t.username),this.retrieveUserAccount()}))}retrieveUserAccount(){this.cookieService.get("token")&&this.cookieService.get("username")&&(this.isLoggedIn.set(!0),this.userService.getLoggedInUser(this.cookieService.get("username")).pipe(v(),l(t=>{this.cookieService.set("currentUser",btoa(JSON.stringify(t[0]))),this.userData.set(t[0])})).subscribe()),this.userData.set(null)}getCurrentUserId(){let t=this.cookieService.get("currentUser");try{return JSON.parse(atob(t)).id}catch{throw new Error("Invalid user cookie")}}static \u0275fac=function(p){return new(p||a)};static \u0275prov=m({token:a,factory:a.\u0275fac,providedIn:"root"})};export{D as a,R as b};
